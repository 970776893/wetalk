var dependencies=["ngAnimate","ngRoute","ngCookies","ngTouch"],app=angular.module("app",dependencies);app.run(function(a){var b={id:1e4,name:"张凯",imgUrl:"/app/displaydata/imgs/zhangkai.png"};a.putObject("loginUser",b)}),app.run(function(a,b){}),app.factory("popup",function(a){return{confim:function(b,c){return a.open({animation:!0,templateUrl:"/app/modules/base/htmls/confim.part.html",controller:function(a,d){a.title=b,a.msg=c,a.ok=function(){d.close("ok")},a.cancel=function(){d.dismiss("cancel")}}})}}}),app.config(function(a){a.defaults.headers.post["Content-Type"]="application/json;charset=utf-8"}),app.directive("weLayout",function(){return{restrict:"EA",templateUrl:"/app/modules/base/htmls/layout.part.html",controller:function(a,b,c){b.$on("$locationChangeSuccess",function(a,d,e){b.url=c.$$url;var f="we-"+d.substring(d.indexOf("#")+2).toLocaleLowerCase();if(f.indexOf("/")>0&&(f=f.substring(0,f.indexOf("/"))),$("body").addClass(f),d!==e){var g="we-"+e.substring(e.indexOf("#")+2).toLocaleLowerCase();g.indexOf("/")>0&&(g=g.substring(0,g.indexOf("/"))),$("body").removeClass(g)}})}}}),app.directive("ngTouchstart",function(){return{controller:function(a,b,c){function d(c){var d=b.attr("ng-touchstart");a.$event=c,a.$apply(d)}b.bind("touchstart",d)}}}),app.directive("ngTouchmove",function(){return{controller:function(a,b,c){function d(a){a.preventDefault(),b.bind("touchmove",e),b.bind("touchend",f)}function e(c){var d=b.attr("ng-touchmove");a.$event=c,a.$apply(d)}function f(a){a.preventDefault(),b.unbind("touchmove",e),b.unbind("touchend",f)}b.bind("touchstart",d)}}}),app.directive("ngTouchend",function(){return{controller:function(a,b,c){function d(c){var d=b.attr("ng-touchend");a.$event=c,a.$apply(d)}b.bind("touchend",d)}}}),app.filter("userStatusFilter",function(a){return function(b){var c=a.i18n.user,d=Number(b);return 0===d?c.statusNormal:1===d?c.statusFrozen:a.i18n["public"].unKnow}}),app.config(function(a){a.when("/userList",{templateUrl:"/app/modules/user/htmls/user_list.html",controller:"userListController"}).when("/talkList",{templateUrl:"/app/modules/talk/htmls/talk_list.html",controller:"talkListController"}).when("/talkWindow/:id",{templateUrl:"/app/modules/talk/htmls/talk_window.html",controller:"talkWindowController"}).otherwise({templateUrl:"/app/modules/base/htmls/unknow.part.html"})}),app.service("weService",function(a){return{getUserList:function(){return a({url:"/app/displaydata/userlist.json",method:"get",dataType:"json"})}}}),app.service("localStorageService",function(a,b){return{getRecentTalkList:function(){var a=b.getObject("loginUser"),c=window.localStorage,d=[];if(c){var e=a.id+"_recent_users";d=c.getItem(e),d=null===d?[]:JSON.parse(d),angular.forEach(d,function(b){var d=a.id+"_recent_user_"+b.userId,e=c.getItem(d);null!=e&&angular.extend(b,JSON.parse(e))})}else console.log("不支持本地存储");return d},handlerReceiveMsg:function(a,c,d,e){var f=b.getObject("loginUser"),g=window.localStorage;if(g){var h=f.id+"_recent_users",i=g.getItem(h);i=null===i?[]:JSON.parse(i);var j=!0;angular.forEach(i,function(b){Number(b.userId)===Number(a)&&(j=!1)}),j&&i.unshift({userId:a,userName:c,userImgUrl:d}),g.setItem(h,JSON.stringify(i));var k=f.id+"_recent_user_"+a;console.log(window.location.hash);var l="#/talkWindow/",m=1;if(-1!==window.location.hash.indexOf(l)){var n=Number(window.location.hash.substring(l.length));a===n&&(m=0)}if(1===m){var o=g.getItem(k);null!==o&&(m=JSON.parse(o).noReadNum+1)}var p={noReadNum:m,lastMsgContent:e,lastMsgTime:(new Date).getTime()};g.setItem(k,JSON.stringify(p))}else console.log("不支持本地存储")}}}),app.controller("talkListController",function(a,b,c,d){b.talkList=d.getRecentTalkList();var e=new Date;angular.forEach(b.talkList,function(a){var b=new Date(a.lastMsgTime);e.getFullYear()===b.getFullYear()&&e.getMonth()===b.getMonth()&&e.getDate()===b.getDate()&&(a.isToday=!0)}),b.talk=function(a){console.log(a),c.path("/talkWindow/"+a.userId)}}),app.controller("talkWindowController",function(a,b,c){b.historyList=[{id:1,content:"双双真矫情",isMine:0},{id:1,content:"对呀对呀",isMine:1},{id:1,content:"反正是很污反正是很污反正是很污反正是很污反正是很污反正是很污反正是很污反正是很污反正是很污",isMine:1},{id:1,content:"有多污啊",isMine:0},{id:1,content:"反正是很污反正是很污反正是很污反正是很污反正是很污反正是很污反正是很污反正是很污反正是很污",isMine:1},{id:1,content:"对呀对呀",isMine:1},{id:1,content:"反正是很污反正是很污反正是很污反正是很污反正是很污反正是很污反正是很污反正是很污反正是很污",isMine:1},{id:1,content:"有多污啊",isMine:0},{id:1,content:"反正是很污反正是很污反正是很污反正是很污反正是很污反正是很污反正是很污反正是很污反正是很污",isMine:1},{id:1,content:"对呀对呀",isMine:1},{id:1,content:"反正是很污反正是很污反正是很污反正是很污反正是很污反正是很污反正是很污反正是很污反正是很污",isMine:1},{id:1,content:"有多污啊",isMine:0},{id:1,content:"反正是很污反正是很污反正是很污反正是很污反正是很污反正是很污反正是很污反正是很污反正是很污",isMine:1}],b.getMsg=function(){var a="我收到你得消息了。-测试";a&&(b.sending=!0,b.historyList.push({id:1,content:a,isMine:0}),b.$apply(),$(document).scrollTop(1e8))},b.sendMsg=function(){var a=$("#msgInput").val();a&&(b.sending=!0,b.historyList.push({id:1,content:a,isMine:1}),b.$apply(),$(document).scrollTop(1e8),$("#msgInput").val(null),b.getMsg())},$(window).scroll(function(){var a=$(window).scrollTop();0===a&&(b.showLoading=!0)}),$("#msgInput").bind("keyup",function(a){13===a.keyCode&&b.sendMsg()}),$("#msgBtn").bind("click",function(){b.sendMsg()})}),app.controller("userListController",function(a,b,c,d){d.getUserList().then(function(a){b.userListOrg=a.data,b.userList=a.data,b.queryKeyList=[],angular.forEach(b.userList,function(a){var c=a.initial,d=!0;angular.forEach(b.queryKeyList,function(a){return a===c?void(d=!1):void 0}),d&&b.queryKeyList.push(c)})}),b.talk=function(a){c.path("/talkWindow/"+a.id)},b.queryByinitial=function(a){console.log(a)},b.queryByKey=function(){b.userList=[],angular.forEach(b.userListOrg,function(a){-1!==a.name.indexOf(b.queryData)&&b.userList.push(a)})},b.queryByKeyBLur=function(){b.userList=b.userListOrg,b.queryData=null},b.queryByKeyFocus=function(){b.userList=[]}});